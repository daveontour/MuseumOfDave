<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's Talk About Dave</title>
    <link rel="stylesheet" href="/static/css/new_page.css">
    <link rel="stylesheet" href="/static/css/leaflet.css">
    <link rel="stylesheet" href="/static/css/images_grid.css">
    <!-- Include marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Optional: highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Font Awesome for icons (optional, but nice for buttons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <div class="sidebar" style="background-color: #19264d;">
            <div class="header-container">
                <h2>Let's Talk About Dave</h2>
                <button id="hamburger-menu" class="hamburger-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="voice-selector">
                <h3>Answer in the Voice Of:</h3>
                
                <!-- Voice Image Display -->
                <div class="voice-image-display" style="background:none !important;">
                    <img id="selected-voice-image" src="/static/images/expert.png" alt="Selected Voice" class="selected-voice-img">
                </div>
                
                <!-- Voice Dropdown Select -->
                <div class="voice-dropdown-container">
                    <select id="voice-select" name="voice">
                        <option value="dave">Dave's own voice</option>
                        <option value="expert" selected>A dispassionate expert</option>
                        <option value="male_friend">Dave's best male friend</option>
                        <option value="female_friend">Dave's best female friend</option>
                        <option value="psychologist">A psychologist</option>
                        <option value="after_death">A friend speaking after Dave's death</option>
                        <option value="irish">A Irish limmerick poet</option>
                        <option value="secret_admirer">A admirer who remained anonymous to Dave</option>
                        <option value="haiku">A Japanese haiku master</option>
                        <option value="insult">An insult commedian</option>
                        <option value="earthchild">A hippy earthchild</option>
                        <option value="bar_girl">A Thai bar girl that Dave told his story to</option>
                        <option value="parents">His mother and father</option>
                        <option value="preacher">A fire and brimstone preacher who disapproves of all aspects of Dave's life</option>
                    </select>
                </div>
                
                <!-- Mood Selector (for Dave voice) -->
                <div id="mood-selector" style="display: none; margin-top: 10px;">
                    <select id="dave-mood" name="dave-mood">
                        <option value="neutral">Neutral - Just Regular Dave</option>
                        <option value="reflective">Reflective - Thoughtful and Contemplative</option>
                        <option value="excited">Excited - Enthusiastic and Energetic</option>
                        <option value="melancholic">Melancholic - Wistful and Nostalgic</option>
                        <option value="depressed">Depressed - Hopeless and Dispondent</option>
                        <option value="philosophical">Philosophical - Deep and Analytical</option>
                        <option value="humorous">Humorous - Witty and Playful</option>
                        <option value="cynical">Cynical - Skeptical and Sardonic</option>
                        <option value="optimistic">Optimistic - Hopeful and Positive</option>
                        <option value="analytical">Analytical - Factual and Detached</option>
                        <option value="angry">Angry - Aggressive and Resentful</option>
                        <option value="sad">Sad - Mournful and Melancholic</option>
                        <option value="anxious">Anxious - Nervous and Worried</option>
                        <option value="content">Content - Satisfied and Content</option>
                        <option value="grateful">Grateful - Appreciative and Thankful</option>
                    </select>
                </div>

                <div class="work-mode-container">
                    <label class="work-mode-label">
                        <input type="checkbox" id="companion-mode" name="companion-mode">
                        <span>Companion Mode</span>
                        <i class="fas fa-heart"></i>
                    </label>

                    
                    <div class="slider-container" style="margin-top: 15px;">
                        <label for="creativity-level">Creativity</label>
                        <input type="range" id="creativity-level" min="0" max="2" step="0.1" value="0">
                        <span class="value-display">0</span>
                    </div>

                    <button type="button" id="interviewer-mode-btn" class="mode-btn" data-mode="interviewer" style="margin-top: 20px;">
                        <i class="fas fa-briefcase"></i>
                        <span>Interviewer Mode</span>
                    </button>
                </div>
            </div>
            
            <!-- More Options Section -->
            <div class="more-options-section">
                <h3>Explore Dave's World</h3>
                <div class="more-options-buttons">
                    <button type="button" class="more-options-btn" id="sms-messages-sidebar-btn">
                        <i class="fas fa-comment-dots"></i> Messages and Chats
                    </button>
                    <button type="button" class="more-options-btn" id="email-gallery-sidebar-btn">
                        <i class="fas fa-envelope"></i> Email Gallery
                    </button>
                    <button type="button" class="more-options-btn" id="email-editor-sidebar-btn">
                        <i class="fas fa-edit"></i> Email Editor
                    </button>
                    <button type="button" class="more-options-btn" id="new-image-gallery-sidebar-btn">
                        <i class="fas fa-images"></i> New Image Gallery
                    </button>
                    <button type="button" class="more-options-btn" id="fb-albums-sidebar-btn">
                        <i class="fas fa-images"></i> Facebook Albums
                    </button>
                    <!-- <button type="button" class="more-options-btn" id="image-gallery-sidebar-btn">
                        <i class="fas fa-photo-video"></i> Image Gallery
                    </button> -->
                    <button type="button" class="more-options-btn" id="locations-sidebar-btn">
                        <i class="fas fa-map-marker-alt"></i> Locations
                    </button>

                    <button type="button" class="more-options-btn" id="suggestions-sidebar-btn">
                        <i class="fas fa-lightbulb"></i> Suggestions
                    </button>
                    <!-- <button type="button" class="more-options-btn" id="have-your-say-sidebar-btn">
                        <i class="fas fa-microphone"></i> Have Your Say
                    </button> -->
                    <button type="button" class="more-options-btn" id="reference-documents-sidebar-btn">
                        <i class="fas fa-folder-open"></i> Reference Documents
                    </button>

                </div>
            </div>
            
            <!-- Interview Control Section (hidden by default) -->
            <div class="interview-control-section" style="display: none;">
                <h3>Interview Controls</h3>
                
                <!-- Interview Purpose Selector -->
                <div class="interview-purpose-selector">
                    <label for="interview-purpose">Interview Purpose:</label>
                    <select id="interview-purpose" name="interview-purpose">
                        <option value="">Select Purpose</option>
                        <option value="biography">Biography Writing</option>
                        <option value="research">Academic Research</option>
                        <option value="journalism">Journalism/Article</option>
                        <option value="therapy">Therapeutic Session</option>
                        <option value="oral-history">Oral History</option>
                        <option value="memoir">Memoir Writing</option>
                        <option value="documentary">Documentary Film</option>
                        <option value="podcast">Podcast Interview</option>
                        <option value="book">Book Research</option>
                        <option value="personal">Personal Interest</option>
                        <option value="family">Family History</option>
                        <option value="professional">Professional Development</option>
                        <option value="creative">Creative Writing</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                            <!-- Interviewee Selection -->
            <div class="interviewee-selection" style="margin-bottom: 20px;">
                <label for="interviewee-select" style="color: #b8e0f7; font-size: 14px; margin-bottom: 5px; display: block;">Interviewee:</label>
                <select id="interviewee-select" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #4a5568; background-color: #2d3748; color: #e2e8f0; margin-bottom: 10px;">
                    <option value="">Loading interviewees...</option>
                </select>
                <button type="button" id="add-interviewee-btn" class="interview-control-btn" style="width: 100%; padding: 8px 12px; font-size: 12px;">
                    <i class="fas fa-plus"></i>
                    <span>Add New Interviewee</span>
                </button>
            </div>
                
                <div class="interview-control-buttons">
                    <button type="button" id="start-interview-btn" class="interview-control-btn">
                        <i class="fas fa-microphone"></i>
                        <span>Start Interview</span>
                    </button>
                    <button type="button" id="resume-interview-btn" class="interview-control-btn">
                        <i class="fas fa-play"></i>
                        <span>Resume Interview</span>
                    </button>
                    <button type="button" id="pause-interview-btn" class="interview-control-btn">
                        <i class="fas fa-pause"></i>
                        <span>Pause Interview</span>
                    </button>
                    <button type="button" id="write-interim-bio-btn" class="interview-control-btn">
                        <i class="fas fa-file-alt"></i>
                        <span>Write Interim Biography</span>
                    </button>
                    <button type="button" id="finish-interview-btn" class="interview-control-btn">
                        <i class="fas fa-stop"></i>
                        <span>Finish Interview</span>
                    </button>
                    <button type="button" id="write-final-bio-btn" class="interview-control-btn">
                        <i class="fas fa-book"></i>
                        <span>Write Final Biography</span>
                    </button>
                    <button type="button" id="reset-interview-btn" class="interview-control-btn">
                        <i class="fas fa-undo"></i>
                        <span>Reset Interview</span>
                    </button>
                </div>
            </div>
            
            {# <p class="model-info">Model: {{ config.GOOGLE_API_MODEL or 'gemini-1.5-pro-latest' }}</p> #}
        </div>

        <div class="chat-main">
            <div class="chat-header">
                <button id="new-chat-btn">New Chat</button>
                <button id="change-user-id-btn">Change User ID</button>
            </div>
            <div id="chat-box">
                <div id="info-box" class="info-box">
                    <div class="info-box-content-wrapper" style="display: flex; flex-direction: row; justify-content: space-between; align-items: flex-start; gap: 2rem;height:280px">
                        <div class="info-content" style="width: 50%;">
                            <ul>
                                <li>Select a voice from the sidebar to get responses from different perspectives</li>
                                <li>If you choose "Dave's own voice", you can also select his current mood</li>
                                <li>Type your questions about Dave in the chat box below</li>
                                <li>Click "Suggestions" for some useful, provocative or fun suggestions</li>
                                <!-- <li>Click "Have Your Say" to enter your own perspective or story about Dave</li> -->
                            </ul>
                        </div>
                        <div id="voice-preview" class="voice-preview" style="width: 50%;display: inline;">
                            <p style="font-weight: bold; color: #2c3e50; margin-bottom: 0.5rem; font-size: 1.1em;">Current Voice</p>
                            <img src="/static/images/expert.png" alt="expert character" class="preview-image">
                            <p class="preview-description">A knowledgeable expert who provides accurate, factual information</p>
                        </div>
                    </div>

                    <div class="voice-flow-container" style="display: grid; grid-template-rows: repeat(2, 1fr); grid-template-columns: repeat(7, 1fr); gap: 15px;">
                        <div class="voice-icon-wrapper" data-voice="dave" data-description="Dave's own voice">
                            <img src="/static/images/dave_sm.png" alt="dave" class="voice-icon">
                        </div>

                        <div class="voice-icon-wrapper" data-voice="expert" data-description="Expert analysis of Dave's situation">
                            <img src="/static/images/expert_sm.png" alt="expert" class="voice-icon">
                        </div>

                        <div class="voice-icon-wrapper" data-voice="male_friend" data-description="A close male friend's view of Dave">
                            <img src="/static/images/male-friend_sm.png" alt="male-friend" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="female_friend" data-description="A female friend's perspective on Dave">
                            <img src="/static/images/female-friend_sm.png" alt="female-friend" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="psychologist" data-description="A professional psychological analysis">
                            <img src="/static/images/psychologist_sm.png" alt="psychologist" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="after_death" data-description="Dave's story from beyond">
                            <img src="/static/images/after-death_sm.png" alt="after-death" class="voice-icon">
                        </div>
                         <div class="voice-icon-wrapper" data-voice="irish" data-description="An Irish perspective on Dave">
                            <img src="/static/images/irish_sm.png" alt="irish" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="secret_admirer" data-description="A secret admirer's loving perspective">
                            <img src="/static/images/secret-admirer_sm.png" alt="secret-admirer" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="haiku" data-description="Dave's story in Haiku form">
                            <img src="/static/images/haiku_sm.png" alt="haiku" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="insult" data-description="A critical view of Dave">
                            <img src="/static/images/insult_sm.png" alt="insult" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="earthchild" data-description="A nature-connected perspective">
                            <img src="/static/images/earthchild_sm.png" alt="earthchild" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="bar_girl" data-description="A bar girl's unique observations">
                            <img src="/static/images/bar-girl_sm.png" alt="bar-girl" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="parents" data-description="Dave's parents' perspective">
                            <img src="/static/images/parents_sm.png" alt="parents" class="voice-icon">
                        </div>
                        <div class="voice-icon-wrapper" data-voice="preacher" data-description="A spiritual interpretation">
                            <img src="/static/images/preacher_sm.png" alt="preacher" class="voice-icon">
                        </div>
                    </div>
                </div>
                <!-- Chat messages will be loaded here -->
                {% for message in history %}
                {% set role = message.role | replace('model', 'assistant') %}
                <div class="message {{ role }}-message">
                    <!-- CHANGE: Add a toolbar div for assistant messages -->
                    {% if role == 'assistant' %}
                    <div class="message-toolbar">
                        <button class="copy-md-btn" title="Copy Markdown">
                            <i class="fa-regular fa-clipboard"></i> Copy
                        </button>
                    </div>
                    {% endif %}
                    <!-- /CHANGE -->
                    <div class="message-content" data-role="{{ role }}">
                        <!-- Raw text initially, JS will render Markdown -->
                        <!-- CHANGE: Store raw markdown in data attribute for JS access -->
                        <textarea class="raw-markdown" style="display:none;">{{ message.parts[0] }}</textarea>
                        <!-- Container for rendered HTML -->
                        <div class="rendered-content">
                            {{ message.parts[0] | safe }} <!-- Keep initial display if JS is slow/fails -->
                        </div>
                        <!-- /CHANGE -->
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" style="display: none;">
                <div class="thinking-dots">
                    <img class="loading-voice-image" src="/static/images/expert.png"
                        alt="Voice character">
                    <span class="thinking-text">Thinking</span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
            </div>

            <!-- Error Display -->
            <div id="error-display" class="error-message" style="display: none;"></div>


            <form id="chat-form" style="background-color: #19264d;padding-left: 0px;">
                <div style="position: relative; width: 100%;">
                    <textarea id="user-input" placeholder="Enter your question or comment..." rows="3" style="width: 100%;"></textarea>
                    <div style="position: absolute; top: 50%; right: 5px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 5px;">
                        <button type="button" id="chat-start-dictation-btn" class="chat-dictation-btn" title="Start voice dictation" style="background: #90EE90; color: #2c3e50; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0z"/>
                                <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"/>
                            </svg>
                        </button>
                        <button type="button" id="chat-stop-dictation-btn" class="chat-dictation-btn" title="Stop voice dictation" style="display: none; background: #FFB6C1; color: #2c3e50; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4m3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3"/>
                                <path d="M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607m-7.84-9.253 12 12L1.646 2.354 1.354 2.06l-.708.708 12 12 .708-.707L2.354 1.646z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="chat-dictation-status" style="color: #b8e0f7; font-size: 12px; margin-top: 5px; min-height: 15px; margin-left: 10px;"></div>
                <button type="submit" id="send-button" >Send</button>
            </form>
        </div>
        
        <!-- Interviewer Mode Layout -->
        <div class="interviewer-main" style="display: none;">
            <div class="interviewer-header">
                <div class="interviewer-header-content">
                    <div class="interviewer-header-left">
                        <h2>Interview Mode</h2>
                        <p>Respond to interview question so the AI can write a biography</p>
                    </div>
                    <div class="interviewer-header-right">
                        <button type="button" id="exit-interviewer-mode-btn" class="exit-interviewer-btn">
                            <i class="fas fa-arrow-left"></i>
                            <span>Back to Normal Mode</span>
                        </button>
                    </div>
                </div>
            </div>
            <div id="interviewer-chat-box">
                <div id="interviewer-info-box" class="interviewer-info-box">
                    <div class="interviewer-info-content">
                        <h3>Welcome to Interview Mode</h3>
                        <p>This is a simplified interface for conducting interviews. You can:</p>
                        <ul>
                            <li>Respond to questions about your life, experiences, and relationships</li>
                            <li>Be confronted by the insights that the AI has about you</li>
                            <li>Focus on the conversation without distractions</li>
                        </ul>
                        <p><strong>Start saying hello to the Kara, the AI Interviewer.</strong></p>
                    </div>
                </div>
                <!-- Interview messages will be loaded here -->
            </div>

            <!-- Interviewer Loading Indicator -->
            <div id="interviewer-loading-indicator" style="display: none;">
                <div class="interviewer-thinking-dots">
                    <img class="interviewer-loading-voice-image" src="/static/images/expert.png"
                        alt="Voice character">
                    <span class="interviewer-thinking-text">Thinking</span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
            </div>

            <!-- Interviewer Error Display -->
            <div id="interviewer-error-display" class="interviewer-error-message" style="display: none;"></div>
<!-- 
            <form id="interviewer-chat-form" style="background-color: #19264d; padding-left: 0px;">
                <div style="position: relative; width: 100%;">
                        <textarea id="interviewer-user-input" placeholder="Respond to your interview question..." rows="3" style="width: 100%;"></textarea>
                        <div style="position: absolute; top: 50%; right: 5px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 5px;">
                            <button type="button" id="interviewer-start-dictation-btn" class="interviewer-dictation-btn" title="Start voice dictation" style="background: #90EE90; color: #2c3e50; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0z"/>
                                    <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"/>
                                </svg>
                            </button>
                            <button type="button" id="interviewer-stop-dictation-btn" class="interviewer-dictation-btn" title="Stop voice dictation" style="display: none; background: #FFB6C1; color: #2c3e50; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4m3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3"/>
                                    <path d="M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607m-7.84-9.253 12 12L1.646 2.354 1.354 2.06l-.708.708 12 12 .708-.707L2.354 1.646z"/>
                                </svg>
                            </button>
                        </div>
                </div>
                <div id="interviewer-dictation-status" style="color: #b8e0f7; font-size: 12px; margin-top: 5px; min-height: 15px; margin-left: 10px;"></div>
                <button type="submit" id="interviewer-send-button" style="height: 40px;">Respond</button>
            </form> -->

            <form id="interviewer-chat-form" style="background-color: #19264d;padding-left: 0px;">
                <div style="position: relative; width: 100%;">
                    <textarea id="interviewer-user-input" placeholder="Enter your response..." rows="3" style="width: 100%;"></textarea>
                    <div style="position: absolute; top: 50%; right: 5px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 5px;">
                        <button type="button" id="interviewer-start-dictation-btn" class="chat-dictation-btn" title="Start voice dictation" style="background: #90EE90; color: #2c3e50; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0z"/>
                                <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"/>
                            </svg>
                        </button>
                        <button type="button" id="interviewer-stop-dictation-btn" class="chat-dictation-btn" title="Stop voice dictation" style="display: none; background: #FFB6C1; color: #2c3e50; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4m3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3"/>
                                <path d="M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607m-7.84-9.253 12 12L1.646 2.354 1.354 2.06l-.708.708 12 12 .708-.707L2.354 1.646z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="chat-dictation-status" style="color: #b8e0f7; font-size: 12px; margin-top: 5px; min-height: 15px; margin-left: 10px;"></div>
                <button type="submit" id="interviewer-send-button" >Respond</button>
            </form>

        </div>
        
        <!-- Configuration Page -->
        <div class="config-page" style="display: none;">
            <div class="config-header">
                <h2>Configuration</h2>
                <button id="close-config" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="config-tabs">
                <button class="config-tab-button active" data-tab="settings">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="config-tab-button" data-tab="api-docs">
                    <i class="fas fa-book"></i> API Docs
                </button>
                <button class="config-tab-button" data-tab="images-grid">
                    <i class="fas fa-images"></i> Email Attachments
                </button>
                <button class="config-tab-button" data-tab="email-controls">
                    <i class="fas fa-envelope"></i> Email Controls
                </button>
                <button class="config-tab-button" data-tab="messaging-controls">
                    <i class="fas fa-comments"></i> Messaging Controls
                </button>
                <button class="config-tab-button" data-tab="facebook-albums">
                    <i class="fas fa-images"></i> Facebook Albums
                </button>
                <button class="config-tab-button" data-tab="image-controls">
                    <i class="fas fa-image"></i> Image Controls
                </button>
            </div>
            <div class="config-content" style="height:calc(100vh - 170px)">
                <div class="config-tab-content active" id="settings-tab">
                    <section class="config-section">
                        <h3>Chat Settings</h3>
                        <div class="setting-group">
                            <label for="message-font-size">Message Font Size</label>
                            <input type="range" id="message-font-size" min="12" max="24" value="16">
                            <span class="value-display">16px</span>
                        </div>
                    </section>
                    <section class="config-section">
                        <h3>Voice and Image Settings</h3>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="show-audio-tags" checked>
                                Show audio tags in messages
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="show-image-tags" checked>
                                Show image links in messages
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="show-json-tags">
                                Show embedded JSON in messages
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="auto-voice-short-responses">
                                Automatically call voice API for responses under 60 words
                            </label>
                        </div>
                    </section>
                    <section class="config-section">
                        <h3>Database Maintenance</h3>
                        <div class="setting-group">
                            <p style="color: #dc3545; margin-bottom: 10px;">
                                <strong>Warning:</strong> This will permanently delete all data from the following tables:
                            </p>
                            <ul style="margin-left: 20px; margin-bottom: 15px; color: #666;">
                                <li>attachments</li>
                                <li>media_blob</li>
                                <li>media_items</li>
                                <li>messages</li>
                                <li>message_attachments</li>
                            </ul>
                            <button type="button" id="empty-media-tables-btn" class="modal-btn" style="background-color: #dc3545; color: white;">
                                <i class="fas fa-trash-alt"></i> Empty Media and Message Tables
                            </button>
                            <div id="empty-tables-status" style="margin-top: 10px; padding: 10px; border-radius: 4px; display: none;"></div>
                        </div>
                    </section>
                    <section class="config-section">
                        <h3>Image Processing</h3>
                        <div class="setting-group">
                            <p style="margin-bottom: 10px;">
                                Process image thumbnails: sync existing thumbnails and generate missing ones.
                            </p>
                            <button type="button" id="process-thumbnails-btn" class="modal-btn">
                                Process Thumbnails
                            </button>
                            <button type="button" id="cancel-thumbnail-processing-btn" class="modal-btn" style="display: none;">
                                Cancel Processing
                            </button>
                        </div>
                        <div id="thumbnail-processing-status" style="display: none; margin-top: 10px;">
                            <div id="thumbnail-processing-status-message"></div>
                            <div id="thumbnail-processing-status-details"></div>
                        </div>
                    </section>
                </div>
                <div class="config-tab-content" id="api-docs-tab">
                    <iframe id="api-docs-iframe" src="/docs"></iframe>
                </div>
                <div class="config-tab-content" id="images-grid-tab">
                    <div class="images-grid-viewer">
                        <div class="container">
                            <div class="header">
                                <h1>Attachments Viewer</h1>
                                <p>View and manage attachments (50 per page)</p>
                            </div>
                            <div class="content">
                                <div class="controls">
                                    <div class="sort-controls">
                                        <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9em; color: #555;">
                                            <input type="checkbox" id="show-all-types-checkbox" onchange="syncTopControls(); changeSortOrder();" style="cursor: pointer;">
                                            <span>Show all file types</span>
                                        </label>
                                        <label style="font-size: 0.9em; color: #555;">Sort by:</label>
                                        <select id="sort-order-select" onchange="syncTopControls(); changeSortOrder();">
                                            <option value="id">ID</option>
                                            <option value="size">Size</option>
                                            <option value="date">Date</option>
                                        </select>
                                        <select id="sort-direction-select" onchange="syncTopControls(); changeSortOrder();">
                                            <option value="asc">Ascending</option>
                                            <option value="desc">Descending</option>
                                        </select>
                                    </div>
                                    <div class="pagination">
                                        <button id="prev-page-btn" onclick="previousPage()">Previous</button>
                                        <span id="page-info">Page 1 of 1</span>
                                        <button id="next-page-btn" onclick="nextPage()">Next</button>
                                    </div>
                                    <button class="delete-selected-btn" id="delete-selected-btn" onclick="deleteSelected()" disabled>Delete Selected</button>
                                </div>
                                
                                <div id="images-grid" class="images-grid" style="display: none;"></div>
                                
                                <div class="controls" id="bottom-controls">
                                    <div class="sort-controls">
                                        <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9em; color: #555;">
                                            <input type="checkbox" id="show-all-types-checkbox-bottom" onchange="syncBottomControls(); changeSortOrder();" style="cursor: pointer;">
                                            <span>Show all file types</span>
                                        </label>
                                        <label style="font-size: 0.9em; color: #555;">Sort by:</label>
                                        <select id="sort-order-select-bottom" onchange="syncBottomControls(); changeSortOrder();">
                                            <option value="id">ID</option>
                                            <option value="size">Size</option>
                                            <option value="date">Date</option>
                                        </select>
                                        <select id="sort-direction-select-bottom" onchange="syncBottomControls(); changeSortOrder();">
                                            <option value="asc">Ascending</option>
                                            <option value="desc">Descending</option>
                                        </select>
                                    </div>
                                    <div class="pagination">
                                        <button id="prev-page-btn-bottom" onclick="previousPage()">Previous</button>
                                        <span id="page-info-bottom">Page 1 of 1</span>
                                        <button id="next-page-btn-bottom" onclick="nextPage()">Next</button>
                                    </div>
                                    <button class="delete-selected-btn" id="delete-selected-btn-bottom" onclick="deleteSelected()" disabled>Delete Selected</button>
                                </div>
                                
                                <div id="image-modal" class="image-modal" onclick="closeModal()">
                                    <span class="close-modal">&times;</span>
                                    <img class="image-modal-content" id="modal-image" style="display: none;">
                                    <iframe class="pdf-modal-content" id="modal-pdf" style="display: none;"></iframe>
                                </div>
                                
                                <div id="metadata-modal" class="metadata-modal" onclick="closeMetadataModal(event)">
                                    <div class="metadata-modal-content" onclick="event.stopPropagation()">
                                        <span class="close-metadata-modal" onclick="closeMetadataModal(event)">&times;</span>
                                        <div id="metadata-content"></div>
                                    </div>
                                </div>
                                
                                <div id="email-modal" class="email-modal" onclick="closeEmailModal(event)">
                                    <div class="email-modal-content" onclick="event.stopPropagation()">
                                        <span class="close-email-modal" onclick="closeEmailModal(event)">&times;</span>
                                        <h2 style="color: #667eea; margin-bottom: 15px;">Email Content</h2>
                                        <div id="email-metadata-display" style="margin-bottom: 20px;"></div>
                                        <div id="email-content" class="email-content"></div>
                                    </div>
                                </div>
                                
                                <div id="loading" class="loading">Loading images...</div>
                                <div id="error" class="error" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="config-tab-content" id="email-controls-tab">
                    <section class="config-section">
                        <h3>Email Processing Controls</h3>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="process-all-folders">
                                Process All Folders
                            </label>
                        </div>
                        <div class="setting-group" id="folder-selection-group">
                            <label for="folder-select">Select Folders:</label>
                            <select id="folder-select" multiple size="10" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                                <option value="">Loading folders...</option>
                            </select>
                            <small style="color: #666; display: block; margin-top: 5px;">Hold Ctrl/Cmd to select multiple folders</small>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="new-only-option" checked>
                                New Only (only process emails not already in database)
                            </label>
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-processing-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start Processing
                            </button>
                            <button type="button" id="cancel-processing-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Processing
                            </button>
                        </div>
                        <div id="processing-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="processing-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="processing-progress-container" style="margin-top: 15px; display: none;">
                                <div id="processing-current-label" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current Label:</strong> <span id="current-label-name">-</span>
                                </div>
                                <div id="processing-label-progress" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="label-progress-text">0 / 0</span>
                                </div>
                                <div id="processing-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="processing-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="processing-emails-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Emails Processed:</strong> <span id="emails-processed-count">0</span>
                                </div>
                            </div>
                            <div id="processing-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                </div>
                <div class="config-tab-content" id="messaging-controls-tab">
                    <section class="config-section">
                        <h3>WhatsApp Import Controls</h3>
                        <div class="setting-group">
                            <label for="whatsapp-import-directory">WhatsApp Export Directory:</label>
                            <input type="text" id="whatsapp-import-directory" placeholder="e.g., C:\iMazingBackup\WhatsApp" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-whatsapp-import-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start WhatsApp Import
                            </button>
                            <button type="button" id="cancel-whatsapp-import-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Import
                            </button>
                        </div>
                        <div id="whatsapp-import-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="whatsapp-import-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="whatsapp-import-progress-container" style="margin-top: 15px; display: none;">
                                <div id="whatsapp-import-current-conversation" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current Conversation:</strong> <span id="whatsapp-current-conversation-name">-</span>
                                </div>
                                <div id="whatsapp-import-conversation-progress" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="whatsapp-conversation-progress-text">0 / 0</span>
                                </div>
                                <div id="whatsapp-import-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="whatsapp-import-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="whatsapp-progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="whatsapp-import-messages-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Messages Imported:</strong> <span id="whatsapp-messages-imported-count">0</span> (<span id="whatsapp-messages-created-count">0</span> new, <span id="whatsapp-messages-updated-count">0</span> updated)
                                </div>
                                <div id="whatsapp-import-attachments-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Attachments:</strong> <span id="whatsapp-attachments-found-count">0</span> found, <span id="whatsapp-attachments-missing-count">0</span> missing
                                </div>
                                <div id="whatsapp-import-errors-count" style="color: #dc3545; font-size: 0.9em;">
                                    <strong>Errors:</strong> <span id="whatsapp-errors-count">0</span>
                                </div>
                                <div id="whatsapp-missing-attachments-list" style="margin-top: 15px; display: none;">
                                    <strong style="color: #333; font-size: 0.95em;">Missing Attachment Files:</strong>
                                    <div id="whatsapp-missing-filenames" style="max-height: 200px; overflow-y: auto; margin-top: 8px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 0.85em; color: #856404;">
                                        <!-- Missing filenames will be listed here -->
                                    </div>
                                </div>
                            </div>
                            <div id="whatsapp-import-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                    <section class="config-section" style="margin-top: 30px;">
                        <h3>Facebook Messenger Import Controls</h3>
                        <div class="setting-group">
                            <label for="facebook-import-directory">Facebook Messenger Export Directory:</label>
                            <input type="text" id="facebook-import-directory" placeholder="e.g., G:\My Drive\meta-2026-Jan-11\your_facebook_activity\messages\e2ee_cutover" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">Path to directory containing Facebook Messenger conversation subdirectories</small>
                        </div>
                        <div class="setting-group" style="margin-top: 10px;">
                            <label for="facebook-user-name">Your Name (Optional):</label>
                            <input type="text" id="facebook-user-name" placeholder="e.g., Dave Burton" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">Your name to determine incoming vs outgoing messages</small>
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-facebook-import-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start Facebook Messenger Import
                            </button>
                            <button type="button" id="cancel-facebook-import-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Import
                            </button>
                        </div>
                        <div id="facebook-import-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="facebook-import-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="facebook-import-progress-container" style="margin-top: 15px; display: none;">
                                <div id="facebook-import-current-conversation" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current Conversation:</strong> <span id="facebook-current-conversation-name">-</span>
                                </div>
                                <div id="facebook-import-conversation-progress" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="facebook-conversation-progress-text">0 / 0</span>
                                </div>
                                <div id="facebook-import-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="facebook-import-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="facebook-progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="facebook-import-messages-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Messages Imported:</strong> <span id="facebook-messages-imported-count">0</span> (<span id="facebook-messages-created-count">0</span> new, <span id="facebook-messages-updated-count">0</span> updated)
                                </div>
                                <div id="facebook-import-attachments-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Attachments:</strong> <span id="facebook-attachments-found-count">0</span> found, <span id="facebook-attachments-missing-count">0</span> missing
                                </div>
                                <div id="facebook-import-errors-count" style="color: #dc3545; font-size: 0.9em;">
                                    <strong>Errors:</strong> <span id="facebook-errors-count">0</span>
                                </div>
                                <div id="facebook-missing-attachments-list" style="margin-top: 15px; display: none;">
                                    <strong style="color: #333; font-size: 0.95em;">Missing Attachment Files:</strong>
                                    <div id="facebook-missing-filenames" style="max-height: 200px; overflow-y: auto; margin-top: 8px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 0.85em; color: #856404;">
                                        <!-- Missing filenames will be listed here -->
                                    </div>
                                </div>
                            </div>
                            <div id="facebook-import-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                    <section style="margin-top: 30px; padding: 20px; background-color: #fff; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h3>Instagram Import Controls</h3>
                        <div class="setting-group" style="margin-top: 10px;">
                            <label for="instagram-import-directory">Instagram Export Directory:</label>
                            <input type="text" id="instagram-import-directory" placeholder="e.g., G:\My Drive\meta-2026-Jan-11\your_instagram_activity\messages\inbox" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">Path to directory containing conversation subdirectories</small>
                        </div>
                        <div class="setting-group" style="margin-top: 10px;">
                            <label for="instagram-user-name">Your Name (Optional):</label>
                            <input type="text" id="instagram-user-name" placeholder="e.g., Dave Burton" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">Your name to determine incoming/outgoing messages</small>
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-instagram-import-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start Instagram Import
                            </button>
                            <button type="button" id="cancel-instagram-import-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Import
                            </button>
                        </div>
                        <div id="instagram-import-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="instagram-import-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="instagram-import-progress-container" style="margin-top: 15px; display: none;">
                                <div id="instagram-import-current-conversation" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current Conversation:</strong> <span id="instagram-current-conversation-name">-</span>
                                </div>
                                <div id="instagram-import-conversation-progress" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="instagram-conversation-progress-text">0 / 0</span>
                                </div>
                                <div id="instagram-import-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="instagram-import-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="instagram-progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="instagram-import-messages-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Messages:</strong> <span id="instagram-messages-imported-count">0</span> imported (<span id="instagram-messages-created-count">0</span> created, <span id="instagram-messages-updated-count">0</span> updated)
                                </div>
                                <div id="instagram-import-errors-count" style="color: #dc3545; font-size: 0.9em;">
                                    <strong>Errors:</strong> <span id="instagram-errors-count">0</span>
                                </div>
                            </div>
                            <div id="instagram-import-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                    <section class="config-section" style="margin-top: 30px;">
                        <h3>iMessage Import Controls</h3>
                        <div class="setting-group">
                            <label for="imessage-directory-path">Directory Path:</label>
                            <input type="text" id="imessage-directory-path" placeholder="Enter directory path..." style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da; font-size: 14px;">
                            <small style="color: #666; display: block; margin-top: 5px;">Path to directory containing iMessage conversation subdirectories</small>
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-imessage-import-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start Import
                            </button>
                            <button type="button" id="cancel-imessage-import-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Import
                            </button>
                        </div>
                        <div id="imessage-import-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="imessage-import-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="imessage-import-progress-container" style="margin-top: 15px; display: none;">
                                <div id="imessage-import-current-conversation" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current Conversation:</strong> <span id="current-conversation-name">-</span>
                                </div>
                                <div id="imessage-import-progress-info" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="imessage-progress-text">0 / 0</span>
                                </div>
                                <div id="imessage-import-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="imessage-import-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="imessage-progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="imessage-import-stats" style="color: #666; font-size: 0.9em;">
                                    <div><strong>Messages Imported:</strong> <span id="imessage-messages-imported">0</span></div>
                                    <div><strong>Messages Created:</strong> <span id="imessage-messages-created">0</span></div>
                                    <div><strong>Messages Updated:</strong> <span id="imessage-messages-updated">0</span></div>
                                    <div><strong>Attachments Found:</strong> <span id="imessage-attachments-found">0</span></div>
                                    <div><strong>Attachments Missing:</strong> <span id="imessage-attachments-missing">0</span></div>
                                    <div><strong>Errors:</strong> <span id="imessage-errors">0</span></div>
                                </div>
                                <div id="imessage-missing-attachments-list" style="margin-top: 15px; display: none;">
                                    <strong style="color: #333; font-size: 0.95em;">Missing Attachment Files:</strong>
                                    <div id="imessage-missing-filenames" style="max-height: 200px; overflow-y: auto; margin-top: 8px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 0.85em; color: #856404;">
                                        <!-- Missing filenames will be listed here -->
                                    </div>
                                </div>
                            </div>
                            <div id="imessage-import-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                </div>
                <div class="config-tab-content" id="facebook-albums-tab">
                    <section class="config-section">
                        <h3>Facebook Albums Import Controls</h3>
                        <div class="setting-group">
                            <label for="facebook-albums-import-directory">Facebook Albums Export Directory:</label>
                            <input type="text" id="facebook-albums-import-directory" placeholder="e.g., G:\My Drive\meta-2026-Jan-11\your_facebook_activity\posts" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">Path to directory containing album JSON files (or the album subdirectory)</small>
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-facebook-albums-import-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start Facebook Albums Import
                            </button>
                            <button type="button" id="cancel-facebook-albums-import-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Import
                            </button>
                        </div>
                        <div id="facebook-albums-import-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="facebook-albums-import-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="facebook-albums-import-progress-container" style="margin-top: 15px; display: none;">
                                <div id="facebook-albums-import-current-album" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current Album:</strong> <span id="facebook-albums-current-album-name">-</span>
                                </div>
                                <div id="facebook-albums-import-album-progress" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="facebook-albums-album-progress-text">0 / 0</span>
                                </div>
                                <div id="facebook-albums-import-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="facebook-albums-import-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="facebook-albums-progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="facebook-albums-import-albums-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Albums Imported:</strong> <span id="facebook-albums-albums-imported-count">0</span>
                                </div>
                                <div id="facebook-albums-import-images-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Images:</strong> <span id="facebook-albums-images-imported-count">0</span> imported, <span id="facebook-albums-images-found-count">0</span> found, <span id="facebook-albums-images-missing-count">0</span> missing
                                </div>
                                <div id="facebook-albums-import-errors-count" style="color: #dc3545; font-size: 0.9em;">
                                    <strong>Errors:</strong> <span id="facebook-albums-errors-count">0</span>
                                </div>
                                <div id="facebook-albums-missing-images-list" style="margin-top: 15px; display: none;">
                                    <strong style="color: #333; font-size: 0.95em;">Missing Image Files:</strong>
                                    <div id="facebook-albums-missing-filenames" style="max-height: 200px; overflow-y: auto; margin-top: 8px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 0.85em; color: #856404;">
                                        <!-- Missing filenames will be listed here -->
                                    </div>
                                </div>
                            </div>
                            <div id="facebook-albums-import-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                </div>
                <div class="config-tab-content" id="image-controls-tab">
                    <section class="config-section">
                        <h3>Filesystem Image Import Controls</h3>
                        <div class="setting-group">
                            <label for="filesystem-import-directory">Root Directory(ies):</label>
                            <input type="text" id="filesystem-import-directory" placeholder="e.g., C:\Users\Dave\Pictures; D:\Photos; E:\Images" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">One or more root directories to search for images, separated by semicolons (searches recursively through all subfolders)</small>
                        </div>
                        <div class="setting-group" style="margin-top: 10px;">
                            <label for="filesystem-import-max-images">Max Images (Optional):</label>
                            <input type="number" id="filesystem-import-max-images" placeholder="Leave empty for all images" min="1" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da;">
                            <small style="color: #666; display: block; margin-top: 5px;">Maximum number of images to import (leave empty to import all)</small>
                        </div>
                        <div class="setting-group" style="margin-top: 10px;">
                            <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="filesystem-import-create-thumbnail" style="cursor: pointer;">
                                <span>Create Thumbnails</span>
                            </label>
                            <small style="color: #666; display: block; margin-top: 5px;">Generate thumbnails for imported images (may slow down import)</small>
                        </div>
                        <div class="setting-group" style="margin-top: 20px;">
                            <button type="button" id="start-filesystem-import-btn" class="modal-btn modal-btn-primary" style="margin-right: 10px;">
                                <i class="fas fa-play"></i> Start Image Import
                            </button>
                            <button type="button" id="cancel-filesystem-import-btn" class="modal-btn modal-btn-secondary" style="display: none;">
                                <i class="fas fa-stop"></i> Cancel Import
                            </button>
                        </div>
                        <div id="filesystem-import-status" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; display: none;">
                            <div id="filesystem-import-status-message" style="color: #333; font-weight: bold; margin-bottom: 10px;"></div>
                            <div id="filesystem-import-progress-container" style="margin-top: 15px; display: none;">
                                <div id="filesystem-import-current-file" style="color: #333; font-size: 0.95em; margin-bottom: 8px;">
                                    <strong>Current File:</strong> <span id="filesystem-current-file-name">-</span>
                                </div>
                                <div id="filesystem-import-file-progress" style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                    <strong>Progress:</strong> <span id="filesystem-file-progress-text">0 / 0</span>
                                </div>
                                <div id="filesystem-import-progress-bar-container" style="width: 100%; background-color: #e9ecef; border-radius: 4px; height: 24px; margin-bottom: 10px; overflow: hidden;">
                                    <div id="filesystem-import-progress-bar" style="height: 100%; background-color: #28a745; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85em; font-weight: bold;">
                                        <span id="filesystem-progress-bar-text">0%</span>
                                    </div>
                                </div>
                                <div id="filesystem-import-images-count" style="color: #666; font-size: 0.9em;">
                                    <strong>Images:</strong> <span id="filesystem-images-imported-count">0</span> imported, <span id="filesystem-images-updated-count">0</span> updated
                                </div>
                                <div id="filesystem-import-errors-count" style="color: #dc3545; font-size: 0.9em;">
                                    <strong>Errors:</strong> <span id="filesystem-errors-count">0</span>
                                </div>
                            </div>
                            <div id="filesystem-import-status-details" style="color: #666; font-size: 0.9em; margin-top: 10px;"></div>
                        </div>
                    </section>
                </div>
            </div>
        </div>



        <!-- Facebook Choose Albums Modal  -->
        <div id="fb-albums-modal" class="modal">
            <div class="modal-content" style="max-width: 1400px; width: 95vw; background: #fff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.18); padding: 0; position: relative; display: flex; flex-direction: column; height: 90vh;">
                <button class="modal-close-btn" id="close-fb-albums-modal" style="position: absolute; top: 12px; right: 18px; font-size: 1.7rem; background: none; border: none; color: #bfc9da; cursor: pointer; z-index: 10;">&times;</button>
                <h2 style="margin: 0; padding: 1rem 2rem; color: #233366; font-size: 1.3em; border-bottom: 1px solid #dee2e6;">Facebook Albums</h2>
                <div style="display: flex; flex: 1; overflow: hidden;">
                    <!-- Master Pane (Left) - Resizable -->
                    <div id="fb-albums-master-pane" style="width: 350px; min-width: 200px; max-width: 600px; border-right: 1px solid #dee2e6; display: flex; flex-direction: column; background-color: #f8f9fa; position: relative;">
                        <div style="padding: 1rem; border-bottom: 1px solid #dee2e6; box-sizing: border-box;">
                            <input type="text" id="fb-albums-search" placeholder="Search albums..." style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bfc9da; font-size: 14px; box-sizing: border-box;">
                        </div>
                        <div id="fb-albums-list" style="flex: 1; overflow-y: auto; padding: 0.5rem;">
                            <!-- Albums will be loaded here -->
                            <div style="text-align: center; padding: 2rem; color: #666;">Loading albums...</div>
                        </div>
                        <!-- Resize handle -->
                        <div id="fb-albums-resize-handle" style="position: absolute; right: 0; top: 0; bottom: 0; width: 4px; cursor: col-resize; background-color: transparent; z-index: 5;"></div>
                    </div>
                    <!-- Slave Pane (Right) -->
                    <div id="fb-albums-slave-pane" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                        <div id="fb-albums-album-header" style="padding: 1rem; border-bottom: 1px solid #dee2e6; background-color: #f8f9fa;">
                            <h3 id="fb-albums-album-title" style="margin: 0; color: #233366; font-size: 1.1em;">Select an album</h3>
                            <p id="fb-albums-album-description" style="margin: 0.5rem 0 0 0; color: #666; font-size: 0.9em;"></p>
                        </div>
                        <div id="fb-albums-images-container" style="flex: 1; overflow-y: auto; padding: 1rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; align-content: start; min-height: 0;">
                            <!-- Images will be displayed here -->
                            <div style="text-align: center; padding: 2rem; color: #666; grid-column: 1 / -1;">Select an album to view images</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Display Suggestions Modal -->
        <div id="tile-suggestions-modal" class="modal">
            <div class="modal-content tile-suggestions-modal-content">
                <div class="modal-suggestions-header">
                    <h2 id="tile-suggestions-modal-title" style="color: #fff;">Suggestions</h2>
                    <button class="modal-suggestions-close-btn" id="modal-suggestions-close-btn" style="font-size: 1.5rem;">&times;</button>
                </div>
                <p id="tile-suggestions-modal-description" style="color: #fff;">Choose a suggestion from one of the categories below</p>
                <div id="tile-suggestions-container" class="tile-suggestions-grid"></div>
            </div>
        </div>

        <!-- Display Have Your Say Modal -->

        <!-- Ask AI Modal -->
        <div id="sms-ask-ai-modal" style="display: none; position: fixed; z-index: 4000 !important; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
            <div style="background-color: white; padding: 2rem; border-radius: 8px; max-width: 500px; width: 90%; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h2 style="margin: 0; color: #233366; font-size: 1.3em;">Ask the AI</h2>
                        <p id="sms-ask-ai-conversation-title" style="margin: 4px 0 0 0; color: #666; font-size: 0.9em; font-weight: normal;"></p>
                    </div>
                    <button id="sms-ask-ai-close" style="background: none; border: none; font-size: 1.5em; color: #666; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" title="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'">
                        <input type="radio" name="sms-ask-ai-option" value="summarise" checked style="margin-right: 10px; cursor: pointer;">
                        <span style="color: #233366; font-size: 1em;">Summarise the Conversation</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'">
                        <input type="radio" name="sms-ask-ai-option" value="imaginary" style="margin-right: 10px; cursor: pointer;">
                        <span style="color: #233366; font-size: 1em;">Create an Imaginary Conversation</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'">
                        <input type="radio" name="sms-ask-ai-option" value="other" style="margin-right: 10px; cursor: pointer;">
                        <span style="color: #233366; font-size: 1em;">Other</span>
                    </label>
                </div>
                <div id="sms-ask-ai-other-text" style="display: none; margin-bottom: 1.5rem;">
                    <textarea id="sms-ask-ai-other-input" placeholder="Enter your question or request..." style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #bfc9da; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical; box-sizing: border-box;"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button id="sms-ask-ai-cancel" style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95em; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#5a6268'" onmouseout="this.style.backgroundColor='#6c757d'">Cancel</button>
                    <button id="sms-ask-ai-submit" style="padding: 10px 20px; background-color: #007AFF; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95em; font-weight: 500; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#0056CC'" onmouseout="this.style.backgroundColor='#007AFF'">Submit</button>
                </div>
            </div>
        </div>
        
        <!-- Conversation Summary Modal -->
        <div id="conversation-summary-modal" class="modal" style="display: none; position: fixed; z-index: 4000 !important; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
            <div class="modal-content" style="max-width: 800px; width: 90vw; background: #fff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.18); padding: 2rem; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="margin: 0; color: #233366; font-size: 1.5em;">Conversation Summary</h2>
                    <button id="close-conversation-summary-modal" style="background: none; border: none; font-size: 1.8em; color: #666; cursor: pointer; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'" title="Close">
                        &times;
                    </button>
                </div>
                <div id="conversation-summary-progress" style="display: none; margin-bottom: 1rem; padding: 1rem; background-color: #f8f9fa; border-radius: 4px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="border: 3px solid #f3f3f3; border-top: 3px solid #007AFF; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite;"></div>
                        <span id="conversation-summary-progress-text" style="color: #666;">Generating summary...</span>
                    </div>
                </div>
                <div id="conversation-summary-content" style="max-height: 60vh; overflow-y: auto; padding: 1rem; background-color: #f8f9fa; border-radius: 4px; line-height: 1.6; color: #333;">
                    <!-- Summary content will be displayed here -->
                </div>
                <div id="conversation-summary-error" style="display: none; margin-top: 1rem; padding: 1rem; background-color: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;">
                    <!-- Error messages will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Email Ask AI Modal -->
        <div id="email-ask-ai-modal" style="display: none; position: fixed; z-index: 4000 !important; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
            <div style="background-color: white; padding: 2rem; border-radius: 8px; max-width: 500px; width: 90%; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h2 style="margin: 0; color: #233366; font-size: 1.3em;">Ask the AI</h2>
                        <p id="email-ask-ai-email-subject" style="margin: 4px 0 0 0; color: #666; font-size: 0.9em; font-weight: normal;"></p>
                    </div>
                    <button id="email-ask-ai-close" style="background: none; border: none; font-size: 1.5em; color: #666; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" title="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'">
                        <input type="radio" name="email-ask-ai-option" value="summarise" checked style="margin-right: 10px; cursor: pointer;">
                        <span style="color: #233366; font-size: 1em;">Summarise Emails with the same sender</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'">
                        <input type="radio" name="email-ask-ai-option" value="imaginary" style="margin-right: 10px; cursor: pointer;">
                        <span style="color: #233366; font-size: 1em;">Create an Imaginary Response</span>
                    </label>
                    <label style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='transparent'">
                        <input type="radio" name="email-ask-ai-option" value="other" style="margin-right: 10px; cursor: pointer;">
                        <span style="color: #233366; font-size: 1em;">Other</span>
                    </label>
                </div>
                <div id="email-ask-ai-other-text" style="display: none; margin-bottom: 1.5rem;">
                    <textarea id="email-ask-ai-other-input" placeholder="Enter your question or request..." style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #bfc9da; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical; box-sizing: border-box;"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button id="email-ask-ai-cancel" style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95em; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#5a6268'" onmouseout="this.style.backgroundColor='#6c757d'">Cancel</button>
                    <button id="email-ask-ai-submit" style="padding: 10px 20px; background-color: #007AFF; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95em; font-weight: 500; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#0056CC'" onmouseout="this.style.backgroundColor='#007AFF'">Submit</button>
                </div>
            </div>
        </div>


        <!-- Geo Metadata Locations Modal -->
        <div id="geo-metadata-modal" class="modal">
            <div class="modal-content geo-metadata-modal-content">
                <button id="close-geo-metadata-modal" class="modal-close-btn">&times;</button>
                <div style="position: absolute; top: 10px; left: 10px; z-index: 1000; display: flex; gap: 0.5em;">
                    <button id="shuffle-photos-btn" class="modal-btn modal-btn-primary" style="background: #233366; color: white; border: none; padding: 0.5em 1em; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
                        <i class="fas fa-random" style="margin-right: 0.5em;"></i>Shuffle Photos
                    </button>
                    <button id="refresh-locations-btn" class="modal-btn modal-btn-primary" style="background: #28a745; color: white; border: none; padding: 0.5em 1em; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
                        <i class="fas fa-sync-alt" style="margin-right: 0.5em;"></i>Refresh
                    </button>
                </div>
                <div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); z-index: 1000;">
                    <h2 style="margin: 0; color: #233366; font-size: 1.5em;">Locations Map</h2>
                </div>
                 <div class="geo-metadata-tab-content geo-tab-images">
                    <div id="map-view"></div>
                </div>
                <div id="geo-metadata-shown-count" style="padding: 1em; background-color: rgba(200, 200, 200, 0.3); position: absolute; bottom: 10px; left: 10px;">                   
                </div>
            </div>
        </div>

        <!-- Image Gallery Modal -->
        <!-- <div id="image-gallery-modal" class="modal">
           <div class="modal-content image-gallery-modal-content">
                <button id="close-image-gallery-modal" class="modal-close-btn">&times;</button>
                <div class="image-gallery-modal-content">
                    <div class="image-gallery-modal-body">
                        <div style="display: flex; flex-direction: column; justify-content: space-between; align-items: flex-start; gap: 2px;padding: 1em;background-color: aliceblue;">
                                    <div class="geo-metadata-filters" style="display: flex; flex-direction:column;gap: 0.4em; margin-bottom: 0.5em; margin-top: 0.5em; margin-left: 10px; align-items: start;">
                                        <div style="display: flex; align-items: center; gap: 0.3em;">
                                            <h2 style="margin: 0; font-size: 1.1em;">Image Gallery</h2> 
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.3em; width:100%">
                                            <input type="text" id="image-gallery-search" placeholder="Search..." style="border-radius: 4px; border: 1px solid #bfc9da; padding: 0.3em; font-size: 0.9em; width: 100%;">
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.3em; align-items: center;">
                                            <select id="image-gallery-year-filter" style="border-radius: 4px; border: 1px solid #bfc9da; padding: 0.3em; font-size: 0.9em;">
                                                <option value="0" selected>All Years</option>
                                                <option value="2033">2033</option>
                                                <option value="2032">2032</option>
                                                <option value="2031">2031</option>
                                                <option value="2030">2030</option>
                                                <option value="2029">2029</option>
                                                <option value="2028">2028</option>
                                                <option value="2027">2027</option>
                                                <option value="2026">2026</option>
                                                <option value="2025">2025</option>
                                                <option value="2024">2024</option>
                                                <option value="2023">2023</option>
                                                <option value="2022">2022</option>
                                                <option value="2021">2021</option>
                                                <option value="2020">2020</option>
                                                <option value="2019">2019</option>
                                                <option value="2018">2018</option>  
                                                <option value="2017">2017</option>
                                                <option value="2016">2016</option>
                                                <option value="2015">2015</option>
                                                <option value="2014">2014</option>
                                                <option value="2013">2013</option>
                                                <option value="2012">2012</option>
                                                <option value="2011">2011</option>
                                                <option value="2010">2010</option>
                                                <option value="2009">2009</option>
                                                <option value="2008">2008</option>
                                                <option value="2007">2007</option>
                                                <option value="2006">2006</option>
                                                <option value="2005">2005</option>
                                                <option value="2004">2004</option>
                                                <option value="2003">2003</option>
                                                <option value="2002">2002</option>
                                                <option value="2001">2001</option>
                                                <option value="2000">2000</option>
                                                <option value="1999">1999</option>
                                                <option value="1998">1998</option>
                                                <option value="1997">1997</option>
                                                <option value="1996">1996</option>
                                                <option value="1995">1995</option>
                                                <option value="1994">1994</option>
                                                <option value="1993">1993</option>
                                                <option value="1992">1992</option>
                                                <option value="1991">1991</option>
                                                <option value="1990">1990</option>
                                            </select> 
                                            <select id="image-gallery-month-filter" style="border-radius: 4px; border: 1px solid #bfc9da; padding: 0.3em; font-size: 0.9em;">
                                                <option value="0" selected>All Months</option>
                                                <option value="1">January</option>
                                                <option value="2">February</option>
                                                <option value="3">March</option>
                                                <option value="4">April</option>
                                                <option value="5">May</option>
                                                <option value="6">June</option>
                                                <option value="7">July</option>
                                                <option value="8">August</option>
                                                <option value="9">September</option>
                                                <option value="10">October</option>
                                                <option value="11">November</option>
                                                <option value="12">December</option>
                                            </select>
                                        </div>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.3em; align-items: center;">
                                            <select id="image-gallery-location-filter" style="border-radius: 4px; border: 1px solid #bfc9da; padding: 0.3em; font-size: 0.9em;">
                                                <option value="all" selected>All Locations</option>
                                                <option value="loc">GPS Data</option>
                                                <option value="non">No GPS Data</option>
                                                <option value="aus">Australian Locations</option>
                                                <option value="dxb">Dubai Locations</option>
                                                <option value="me">Middle East</option>
                                                <option value="eur">European Locations</option>
                                                <option value="usa">USA Locations & Canada</option>
                                                <option value="af">African Locations</option>
                                                <option value="asia">Asian Locations</option>
                                                <option value="oth">Other Locations</option>
                                            </select>
                                            <select id="image-gallery-source-filter" style="border-radius: 4px; border: 1px solid #bfc9da; padding: 0.3em; font-size: 0.9em;">
                                            </select>                                         

                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.3em;">
                                            <button id="image-gallery-search-btn" class="modal-btn modal-btn-primary" style="background: #233366; color: white; border: none; padding: 0.3em 0.8em; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                                                <i class="fas fa-search" style="margin-right: 0.3em;"></i>Search
                                            </button>
                                            <button id="image-gallery-clear-btn" class="modal-btn modal-btn-secondary" style="background: #6c757d; color: white; border: none; padding: 0.3em 0.8em; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                                                <i class="fas fa-times" style="margin-right: 0.3em;"></i>Clear
                                            </button>
                                        </div>
                                    </div>
                                    <div class="image-gallery-list" id="image-gallery-list"></div>
                        </div>
                        <div class="image-gallery-image">
                                <div id="image-gallery-image-details" style="padding: 5px; background-color: rgba(200, 200, 200, 0.3); position: absolute; top: 10px; left: 10px;"></div>
                                <button id="download-image-gallery-btn" class="download-btn" title="Download this item" style="position: absolute; top: 15px; right: 60px;">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <div id="image-gallery-map"></div>
                                <img id="image-gallery-image" src="" frameborder="0"></img>
                                <div id="image-gallery-instructions" style="margin-top: 1em; margin-bottom: 1em;">
                                    Select a thumbnail from the list on the left to view the image and location details
                                </div>
                                <div id="image-gallery-audio-container" style="display: none;">
                                    <audio id="image-gallery-audio-player" controls></audio>
                                </div>
                                <div id="image-gallery-video-container" style="display: none;">
                                    <video id="image-gallery-video-player" controls style="max-width: 100%; max-height: 400px;"></video>
                                </div>
                                <div id="image-gallery-pdf-container" style="display: none; width: 100%; height: 600px;">
                                    <iframe id="image-gallery-pdf-viewer" style="width: 100%; height: 100%; border: none;"></iframe>
                                </div>
                                <button class="image-gallery-fixed-btn" id="image-gallery-fixed-btn" title="Action"><i class="fa fa-map-marked-alt" style="margin-right: 10px;"></i>Show In Google Maps</button>
                        </div>
                    </div>
                </div>
           </div>
        </div> -->

        <!-- Email Gallery Modal -->
        <div id="email-gallery-modal" class="modal">
           <div class="modal-content email-gallery-modal-content">
                <button id="close-email-gallery-modal" class="modal-close-btn">&times;</button>
                <div class="email-gallery-modal-body">
                    <!-- Master Pane -->
                    <div class="email-gallery-master-pane">
                        <div class="email-gallery-search-section">
                            <div class="email-metadata-filters">
                                <div class="email-gallery-title">
                                    <h2>Email Gallery</h2> 
                                </div>
                                <div class="email-gallery-search-row">
                                    <input type="text" id="email-gallery-search" placeholder="Search emails..." class="email-gallery-input">
                                </div>
                                <div class="email-gallery-filter-row">
                                    <input type="text" id="email-gallery-sender" placeholder="From..." class="email-gallery-input">
                                    <input type="text" id="email-gallery-recipient" placeholder="To..." class="email-gallery-input">
                                </div>
                                <div class="email-gallery-filter-row-full">
                                    <input type="text" id="email-gallery-to-from" placeholder="To or From..." class="email-gallery-input">
                                </div> 
                                <div class="email-gallery-filter-row">
                                    <select id="email-gallery-year-filter" class="email-gallery-select"></select>                                         
                                    <select id="email-gallery-month-filter" class="email-gallery-select"></select>
                                    <label class="email-gallery-checkbox-label">
                                        <input type="checkbox" id="email-gallery-attachments-filter">
                                        Attachments
                                    </label>
                                </div>
                                <div class="email-gallery-button-row">
                                    <button id="email-gallery-search-btn" class="modal-btn modal-btn-primary">
                                        <i class="fas fa-search"></i>Search
                                    </button>
                                    <button id="email-gallery-clear-btn" class="modal-btn modal-btn-secondary">
                                        <i class="fas fa-times"></i>Clear
                                    </button>
                                    <button id="email-gallery-view-toggle" class="modal-btn modal-btn-secondary" title="Toggle view">
                                        <i class="fas fa-th"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="email-gallery-list" id="email-gallery-list"></div>
                    </div>
                    <!-- Resizable Divider -->
                    <div class="email-gallery-divider" id="email-gallery-divider"></div>
                    <!-- Detail Pane -->
                    <div class="email-gallery-detail-pane">
                        <div id="email-gallery-instructions" class="email-gallery-instructions">
                            Select an email from the list on the left to view its content
                        </div>
                        <div id="email-gallery-email-content" class="email-gallery-email-content" style="display: none;">
                            <div class="email-gallery-metadata-section" style="padding-top: 50px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                    <div style="flex: 1;">
                                        <div class="email-gallery-metadata-row">
                                            <span class="email-gallery-metadata-label">Subject:</span>
                                            <span class="email-gallery-metadata-value" id="email-gallery-metadata-subject"></span>
                                        </div>
                                        <div class="email-gallery-metadata-row">
                                            <span class="email-gallery-metadata-label">From:</span>
                                            <span class="email-gallery-metadata-value" id="email-gallery-metadata-from"></span>
                                        </div>
                                        <div class="email-gallery-metadata-row">
                                            <span class="email-gallery-metadata-label">Date:</span>
                                            <span class="email-gallery-metadata-value" id="email-gallery-metadata-date"></span>
                                        </div>
                                        <div class="email-gallery-metadata-row">
                                            <span class="email-gallery-metadata-label">Folder:</span>
                                            <span class="email-gallery-metadata-value" id="email-gallery-metadata-folder"></span>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <button id="email-ask-ai-btn" style="display: none; background-color: #9B59B6; color: white; border: none; cursor: pointer; font-size: 0.9em; padding: 8px 16px; border-radius: 8px; transition: background-color 0.2s; font-weight: 500;" title="Ask the AI" onmouseover="this.style.backgroundColor='#7D3C98'" onmouseout="this.style.backgroundColor='#9B59B6'">
                                            <i class="fas fa-robot" style="margin-right: 6px;"></i>Ask the AI
                                        </button>
                                        <button id="email-delete-btn" style="display: none; background: none; border: none; color: #54656f; cursor: pointer; font-size: 1.2em; padding: 8px; border-radius: 50%; transition: background-color 0.2s;" title="Delete email" onmouseover="this.style.backgroundColor='#e4e6eb'" onmouseout="this.style.backgroundColor='transparent'">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="email-gallery-iframe-container">
                                <iframe id="email-gallery-iframe" class="email-gallery-iframe"></iframe>
                            </div>
                            <div class="email-gallery-attachments-section">
                                <h3 class="email-gallery-attachments-title">Attachments</h3>
                                <div class="email-gallery-attachments-grid" id="email-gallery-attachments-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
           </div>
        </div>
        
        <!-- Email Editor Modal -->
        <div id="email-editor-modal" class="modal">
            <div class="modal-content email-editor-modal-content">
                <button id="close-email-editor-modal" class="modal-close-btn">&times;</button>
                <div class="email-editor-modal-body">
                    <!-- Upper Pane: Search Criteria -->
                    <div class="email-editor-search-pane">
                        <div class="email-metadata-filters">
                            <div class="email-gallery-title">
                                <h2>Email Editor</h2> 
                            </div>
                            <div class="email-gallery-search-row">
                                <input type="text" id="email-editor-search" placeholder="Search emails..." class="email-gallery-input">
                            </div>
                            <div class="email-gallery-filter-row">
                                <input type="text" id="email-editor-sender" placeholder="From..." class="email-gallery-input">
                                <input type="text" id="email-editor-recipient" placeholder="To..." class="email-gallery-input">
                            </div>
                            <div class="email-gallery-filter-row-full">
                                <input type="text" id="email-editor-to-from" placeholder="To or From..." class="email-gallery-input">
                            </div> 
                            <div class="email-gallery-filter-row">
                                <select id="email-editor-year-filter" class="email-gallery-select"></select>                                         
                                <select id="email-editor-month-filter" class="email-gallery-select"></select>
                                <label class="email-gallery-checkbox-label">
                                    <input type="checkbox" id="email-editor-attachments-filter">
                                    Attachments
                                </label>
                            </div>
                            <div class="email-gallery-button-row">
                                <button id="email-editor-search-btn" class="modal-btn modal-btn-primary">
                                    <i class="fas fa-search"></i>Search
                                </button>
                                <button id="email-editor-clear-btn" class="modal-btn modal-btn-secondary">
                                    <i class="fas fa-times"></i>Clear
                                </button>
                                <button id="email-editor-bulk-delete-btn" class="modal-btn modal-btn-danger" style="display: none; margin-left: auto;">
                                    <i class="fas fa-trash"></i> Delete Selected
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Lower Pane: Email Table -->
                    <div class="email-editor-table-pane">
                        <div class="email-editor-table-container">
                            <table class="email-editor-table">
                                <thead>
                                    <tr>
                                        <th class="email-editor-col-subject">Subject</th>
                                        <th class="email-editor-col-from">From</th>
                                        <th class="email-editor-col-to">To</th>
                                        <th class="email-editor-col-date">Date</th>
                                        <th class="email-editor-col-personal">Personal</th>
                                        <th class="email-editor-col-business">Business</th>
                                        <th class="email-editor-col-important">Important</th>
                                        <th class="email-editor-col-use-by-ai">Use by AI</th>
                                        <th class="email-editor-col-delete">Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="email-editor-table-body">
                                    <!-- Email rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="email-editor-pagination" id="email-editor-pagination">
                            <!-- Pagination controls will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Attachment Image Modal -->
        <div id="email-attachment-image-modal" class="modal email-attachment-modal">
            <div class="email-attachment-modal-content">
                <button id="close-email-attachment-image-modal" class="modal-close-btn">&times;</button>
                <img id="email-attachment-image-display" class="email-attachment-image-display" src="" alt="Attachment">
            </div>
        </div>
        
        <!-- Attachment Document Modal -->
        <div id="email-attachment-document-modal" class="modal email-attachment-modal">
            <div class="email-attachment-modal-content email-attachment-document-content">
                <button id="close-email-attachment-document-modal" class="modal-close-btn">&times;</button>
                <iframe id="email-attachment-document-iframe" class="email-attachment-document-iframe"></iframe>
            </div>
        </div>
        
        <!-- New Image Gallery Modal -->
        <div id="new-image-gallery-modal" class="modal">
           <div class="modal-content new-image-gallery-modal-content">
                <button id="close-new-image-gallery-modal" class="modal-close-btn">&times;</button>
                <div class="new-image-gallery-modal-body">
                    <!-- Master Pane -->
                    <div class="new-image-gallery-master-pane">
                        <div class="new-image-gallery-search-section">
                            <div class="new-image-metadata-filters">
                                <div class="new-image-gallery-title" style="display: flex; justify-content: space-between; align-items: center;">
                                    <h2 style="margin: 0;">Image Gallery</h2>
                                    <label class="new-image-gallery-select-mode-toggle" style="display: flex; align-items: center; gap: 0.5em; cursor: pointer;">
                                        <input type="checkbox" id="new-image-gallery-select-mode" style="cursor: pointer;">
                                        <span>Select Mode</span>
                                    </label>
                                </div>
                                <!-- <div id="new-image-gallery-bulk-edit-section" style="display: none; padding: 1em; background-color: #e8f4f8; border-radius: 4px; margin-top: 1em;">
                                    <div style="margin-bottom: 0.5em; font-weight: 600; color: #233366;">
                                        <span id="new-image-gallery-selected-count">0</span> image(s) selected
                                    </div>
                                    <div style="display: flex; gap: 0.5em; align-items: center;">
                                        <input type="text" id="new-image-gallery-bulk-tags" placeholder="Enter tags to apply..." class="new-image-gallery-input" style="flex: 1;">
                                        <button id="new-image-gallery-apply-tags-btn" class="modal-btn modal-btn-primary" disabled>
                                            <i class="fas fa-tags"></i> Apply Tags
                                        </button>
                                        <button id="new-image-gallery-clear-selection-btn" class="modal-btn modal-btn-secondary">
                                            <i class="fas fa-times"></i> Clear Selection
                                        </button>
                                    </div>
                                </div> -->
                                <div class="new-image-gallery-search-row">
                                    <input type="text" id="new-image-gallery-title" placeholder="Title..." class="new-image-gallery-input">
                                </div>
                                <div class="new-image-gallery-search-row">
                                    <input type="text" id="new-image-gallery-description" placeholder="Description..." class="new-image-gallery-input">
                                </div>
                                <div class="new-image-gallery-search-row">
                                    <input type="text" id="new-image-gallery-tags" placeholder="Tags..." class="new-image-gallery-input" list="new-image-gallery-tags-list">
                                    <datalist id="new-image-gallery-tags-list"></datalist>
                                </div>
                                <div class="new-image-gallery-filter-row">
                                    <input type="text" id="new-image-gallery-author" placeholder="Author..." class="new-image-gallery-input">
                                    <input type="text" id="new-image-gallery-source" placeholder="Source..." class="new-image-gallery-input">
                                </div>
                                <div class="new-image-gallery-filter-row">
                                    <select id="new-image-gallery-year-filter" class="new-image-gallery-select"></select>                                         
                                    <select id="new-image-gallery-month-filter" class="new-image-gallery-select"></select>
                                </div>
                                <div class="new-image-gallery-filter-row">
                                    <input type="number" id="new-image-gallery-rating" placeholder="Rating (1-5)" min="1" max="5" class="new-image-gallery-input">
                                    <input type="number" id="new-image-gallery-rating-min" placeholder="Min Rating" min="1" max="5" class="new-image-gallery-input">
                                    <input type="number" id="new-image-gallery-rating-max" placeholder="Max Rating" min="1" max="5" class="new-image-gallery-input">
                                </div>
                                <div class="new-image-gallery-filter-row">
                                    <label class="new-image-gallery-checkbox-label">
                                        <input type="checkbox" id="new-image-gallery-has-gps">
                                        Has GPS
                                    </label>
                                    <label class="new-image-gallery-checkbox-label">
                                        <input type="checkbox" id="new-image-gallery-processed">
                                        Processed
                                    </label>
                                </div>
                                <div class="new-image-gallery-button-row">
                                    <button id="new-image-gallery-search-btn" class="modal-btn modal-btn-primary">
                                        <i class="fas fa-search"></i>Search
                                    </button>
                                    <button id="new-image-gallery-clear-btn" class="modal-btn modal-btn-secondary">
                                        <i class="fas fa-times"></i>Clear
                                    </button>
                                </div>
                            </div>
                            <div class="new-image-gallery-right-hand-box">
                                <div id="new-image-gallery-bulk-edit-section" style="display: none; padding: 1em; background-color: #e8f4f8; border-radius: 4px; margin-top: 2em;">
                                    <div style="margin-bottom: 0.5em; font-weight: 600; color: #233366;">
                                        <span id="new-image-gallery-selected-count">0</span> image(s) selected
                                    </div>
                                    <div style="display: flex; gap: 0.5em; align-items: center;">
                                        <input type="text" id="new-image-gallery-bulk-tags" placeholder="Enter tags to apply..." class="new-image-gallery-input" style="flex: 1;">
                                        <button id="new-image-gallery-apply-tags-btn" class="modal-btn modal-btn-primary" disabled style="width: 200px;">
                                            <i class="fas fa-tags"></i> Apply Tags
                                        </button>
                                        <!-- <button id="new-image-gallery-delete-selected-btn" class="modal-btn modal-btn-danger" disabled>
                                            <i class="fas fa-trash-alt"></i> Delete Selected
                                        </button>
                                        <button id="new-image-gallery-clear-selection-btn" class="modal-btn modal-btn-secondary">
                                            <i class="fas fa-times"></i> Clear Selection
                                        </button> -->
                                    </div>
                                    <div style="display: flex; gap: 0.5em; align-items: end;flex-direction: column; margin-top: 1em;">
                                        <button id="new-image-gallery-delete-selected-btn" class="modal-btn modal-btn-danger" disabled style="width: 200px;">
                                            <i class="fas fa-trash-alt"></i> Delete Selected
                                        </button>
                                        <button id="new-image-gallery-clear-selection-btn" class="modal-btn modal-btn-secondary" style="width: 200px;">
                                            <i class="fas fa-times"></i> Clear Selection
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="new-image-gallery-thumbnail-grid" id="new-image-gallery-thumbnail-grid"></div>
                    </div>
                </div>
           </div>
        </div>
        
        <!-- New Image Gallery Detail Modal -->
        <div id="new-image-gallery-detail-modal" class="modal">
            <div class="modal-content new-image-gallery-detail-modal-content">
                <button id="close-new-image-gallery-detail-modal" class="modal-close-btn">&times;</button>
                <div class="new-image-gallery-detail-modal-body">
                    <!-- Image Section -->
                    <div class="new-image-gallery-detail-image-section">
                        <img id="new-image-gallery-detail-image" class="new-image-gallery-detail-full-image" src="" alt="Image">
                    </div>
                    <!-- Metadata Section -->
                    <div class="new-image-gallery-detail-metadata-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
                            <h2 style="margin: 0;">Image Metadata</h2>
                            <div style="display: flex; gap: 0.5em;">
                                <button id="new-image-gallery-save-btn" class="modal-btn" style="display: none;" disabled>
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <button id="new-image-gallery-delete-btn" class="modal-btn modal-btn-danger" style="display: none;">
                                    <i class="fas fa-trash-alt"></i> Delete Image
                                </button>
                            </div>
                        </div>
                        <div class="new-image-gallery-detail-metadata-content">
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Title:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-title"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Author:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-author"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row new-image-gallery-detail-metadata-row-full">
                                <span class="new-image-gallery-detail-metadata-label">Description:</span>
                                <textarea class="new-image-gallery-detail-metadata-editable" id="new-image-detail-description-edit" rows="3" placeholder="Enter description"></textarea>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row new-image-gallery-detail-metadata-row-full">
                                <span class="new-image-gallery-detail-metadata-label">Tags:</span>
                                <input type="text" class="new-image-gallery-detail-metadata-editable" id="new-image-detail-tags-edit" placeholder="Enter tags (comma-separated)">
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Categories:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-categories"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Notes:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-notes"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Date:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-date"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Rating:</span>
                                <div class="star-rating-container" id="new-image-detail-rating-container">
                                    <span class="star" data-rating="1"></span>
                                    <span class="star" data-rating="2"></span>
                                    <span class="star" data-rating="3"></span>
                                    <span class="star" data-rating="4"></span>
                                    <span class="star" data-rating="5"></span>
                                    <input type="hidden" id="new-image-detail-rating-edit" value="">
                                </div>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Image Type:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-image-type"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Source:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-source"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Source Reference:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-source-reference"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Region:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-region"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row" id="new-image-detail-gps-row" style="display: none;">
                                <span class="new-image-gallery-detail-metadata-label">GPS Location:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-gps"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row" id="new-image-detail-altitude-row" style="display: none;">
                                <span class="new-image-gallery-detail-metadata-label">Altitude:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-altitude"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Available for Task:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-available-for-task"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Processed:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-processed"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Location Processed:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-location-processed"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Image Processed:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-image-processed"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Created At:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-created-at"></span>
                            </div>
                            <div class="new-image-gallery-detail-metadata-row">
                                <span class="new-image-gallery-detail-metadata-label">Updated At:</span>
                                <span class="new-image-gallery-detail-metadata-value" id="new-image-detail-updated-at"></span>
                            </div>
                        </div>
                    </div>
                </div>
    </div>
</div>

        <!-- Reference Documents Notification Modal -->
        <div id="reference-documents-notification-modal" class="modal" style="display: none; position: fixed; z-index: 4000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
            <div class="modal-content" style="max-width: 700px; width: 90vw; background: #fff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.18); padding: 2rem; position: relative;">
                <button class="modal-close-btn" id="close-reference-documents-notification-modal" style="position: absolute; top: 12px; right: 18px; font-size: 1.7rem; background: none; border: none; color: #bfc9da; cursor: pointer;">&times;</button>
                <div style="margin-bottom: 1.5rem;">
                    <h2 style="margin: 0 0 0.5rem 0; color: #233366; font-size: 1.5em;">Reference Documents</h2>
                    <p style="margin: 0; color: #666; font-size: 0.95em;">Reference documents that will be included in your chat are shown below. Documents not selected for chat are also listed.</p>
                </div>
                <div id="reference-documents-notification-list" style="max-height: 400px; overflow-y: auto; margin-bottom: 1.5rem; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem;">
                    <!-- Documents will be listed here -->
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" id="reference-documents-notification-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                    <button type="button" id="reference-documents-notification-proceed" class="modal-btn modal-btn-primary">Proceed</button>
                </div>
            </div>
        </div>

        <!-- Reference Documents Modal -->
        <div id="reference-documents-modal" class="modal">
            <div class="modal-content reference-documents-modal-content">
                <button id="close-reference-documents-modal" class="modal-close-btn">&times;</button>
                <div class="reference-documents-header">
                    <h2>Reference Documents</h2>
                </div>
                <div class="reference-documents-body">
                    <!-- Search and Filters -->
                    <div class="reference-documents-filters">
                        <div class="reference-documents-search-row">
                            <input type="text" id="reference-documents-search" placeholder="Search documents..." class="reference-documents-input">
                            <button id="reference-documents-upload-btn" class="modal-btn modal-btn-primary">
                                <i class="fas fa-upload"></i> Upload Document
                            </button>
                        </div>
                        <div class="reference-documents-filter-row">
                            <select id="reference-documents-category-filter" class="reference-documents-select">
                                <option value="">All Categories</option>
                            </select>
                            <select id="reference-documents-content-type-filter" class="reference-documents-select">
                                <option value="">All Types</option>
                                <option value="application/pdf">PDF</option>
                                <option value="application/msword">Word (DOC)</option>
                                <option value="application/vnd.openxmlformats-officedocument.wordprocessingml.document">Word (DOCX)</option>
                                <option value="image">Images</option>
                                <option value="text">Text Files</option>
                                <option value="text/csv">CSV</option>
                                <option value="application/json">JSON</option>
                            </select>
                            <label class="reference-documents-checkbox-label">
                                <input type="checkbox" id="reference-documents-task-filter">
                                Available for Task
                            </label>
                        </div>
                    </div>
                    <!-- Document List -->
                    <div class="reference-documents-list" id="reference-documents-list"></div>
                </div>
            </div>
        </div>
        
        <!-- Upload Document Modal -->
        <div id="reference-documents-upload-modal" class="modal">
            <div class="modal-content reference-documents-upload-content">
                <button id="close-reference-documents-upload-modal" class="modal-close-btn">&times;</button>
                <h2>Upload Reference Document</h2>
                <form id="reference-documents-upload-form" class="reference-documents-upload-form">
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-file">File *</label>
                        <input type="file" id="reference-documents-upload-file" name="file" required>
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-title">Title</label>
                        <input type="text" id="reference-documents-upload-title" name="title" placeholder="Document title">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-description">Description</label>
                        <textarea id="reference-documents-upload-description" name="description" rows="3" placeholder="Document description"></textarea>
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-author">Author</label>
                        <input type="text" id="reference-documents-upload-author" name="author" placeholder="Author name">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-tags">Tags (comma-separated)</label>
                        <input type="text" id="reference-documents-upload-tags" name="tags" placeholder="tag1, tag2, tag3">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-categories">Categories (comma-separated)</label>
                        <input type="text" id="reference-documents-upload-categories" name="categories" placeholder="category1, category2">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-upload-notes">Notes</label>
                        <textarea id="reference-documents-upload-notes" name="notes" rows="3" placeholder="Additional notes"></textarea>
                    </div>
                    <div class="reference-documents-form-group">
                        <label class="reference-documents-checkbox-label">
                            <input type="checkbox" id="reference-documents-upload-task" name="available_for_task">
                            Available for Task
                        </label>
                    </div>
                    <div class="reference-documents-form-actions">
                        <button type="submit" class="modal-btn modal-btn-primary">Upload</button>
                        <button type="button" id="reference-documents-upload-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Edit Document Modal -->
        <div id="reference-documents-edit-modal" class="modal">
            <div class="modal-content reference-documents-upload-content">
                <button id="close-reference-documents-edit-modal" class="modal-close-btn">&times;</button>
                <h2>Edit Document Metadata</h2>
                <form id="reference-documents-edit-form" class="reference-documents-upload-form">
                    <input type="hidden" id="reference-documents-edit-id">
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-edit-title">Title</label>
                        <input type="text" id="reference-documents-edit-title" name="title" placeholder="Document title">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-edit-description">Description</label>
                        <textarea id="reference-documents-edit-description" name="description" rows="3" placeholder="Document description"></textarea>
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-edit-author">Author</label>
                        <input type="text" id="reference-documents-edit-author" name="author" placeholder="Author name">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-edit-tags">Tags (comma-separated)</label>
                        <input type="text" id="reference-documents-edit-tags" name="tags" placeholder="tag1, tag2, tag3">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-edit-categories">Categories (comma-separated)</label>
                        <input type="text" id="reference-documents-edit-categories" name="categories" placeholder="category1, category2">
                    </div>
                    <div class="reference-documents-form-group">
                        <label for="reference-documents-edit-notes">Notes</label>
                        <textarea id="reference-documents-edit-notes" name="notes" rows="3" placeholder="Additional notes"></textarea>
                    </div>
                    <div class="reference-documents-form-group">
                        <label class="reference-documents-checkbox-label">
                            <input type="checkbox" id="reference-documents-edit-task" name="available_for_task">
                            Available for Task
                        </label>
                    </div>
                    <div class="reference-documents-form-actions">
                        <button type="submit" class="modal-btn modal-btn-primary">Save Changes</button>
                        <button type="button" id="reference-documents-edit-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        
        

        <!-- Confirmation Modal -->
        <div id="confirmation-modal" class="modal confirmation-modal">
            <div class="modal-content confirmation-modal-content">
                    <div class="confirmation-modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 id="confirmation-modal-title" style="margin: 0;"></h2>
                        <button class="modal-close-btn" id="close-confirmation-modal">&times;</button>
                    </div>
                <p id="confirmation-modal-text"></p>
                <div class="confirmation-modal-buttons">
                        <button type="button" id="confirmation-modal-confirm" class="modal-btn modal-btn-primary">Confirm</button>
    <button type="button" id="confirmation-modal-cancel" class="modal-btn modal-btn-secondary">Cancel</button>
</div>
</div>
</div>

<!-- Add Interviewee Modal -->
<div id="add-interviewee-modal" class="modal">
<div class="modal-content" style="max-width: 500px; width: 95vw; background: #fff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.18); padding: 2rem; position: relative;">
    <button class="modal-close-btn" id="close-add-interviewee-modal" style="position: absolute; top: 12px; right: 18px; font-size: 1.7rem; background: none; border: none; color: #bfc9da; cursor: pointer;">&times;</button>
    <div class="modal-header">
        <h2 style="margin: 0; color: #2c3e50;">Add New Interviewee</h2>
    </div>
    <div class="modal-body" style="margin: 20px 0;">
        <label for="new-interviewee-name" style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: bold;">Interviewee Name:</label>
        <input type="text" id="new-interviewee-name" placeholder="Enter interviewee name..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
    </div>
    <div class="modal-btn-row" style="display: flex; gap: 10px; justify-content: flex-end;">
        <button type="button" id="add-interviewee-submit-btn" class="modal-btn modal-btn-primary">Add Interviewee</button>
        <button type="button" id="add-interviewee-cancel-btn" class="modal-btn modal-btn-secondary">Cancel</button>
    </div>
</div>
</div>

        <!-- Single Image Modal -->
        <div id="single-image-modal" class="modal">
            <div class="modal-content single-image-modal-content">
                <div class="single-image-container">
                    <div id="single-image-details" class="single-image-details"></div>
                    <button id="close-single-image-modal" class="single-image-close-btn">&times;</button>
                    <img id="single-image-modal-img" src="" alt="Image" class="single-image-display" />
                    <audio id="single-image-modal-audio" controls class="single-audio-display"></audio>
                    <video id="single-image-modal-video" controls class="single-video-display"></video>
                    <iframe id="single-image-modal-pdf" src="" frameborder="0" class="single-pdf-display"></iframe>
                    
                </div>
            </div>
        </div>

        <!-- Just a note that to display the multi-image modal, you need to call the showMultiImageModal function from the scriptv2.js file 
             and pass in the images array and the current image uri.
             For example:
             Modals.MultiImageDisplay.showMultiImageModal(images, uri);
             The HTML for the fb album modal is all dynamically created in the javascript file.
        -->

        <!-- Display album images Modal -->
        <div id="fb-album-modal" class="modal">
            <div class="modal-content tile-album-modal-content">
                <button id="close-fb-album-modal" class="modal-album-close-btn">&times;</button>
                <h2 id="fb-album-modal-title"></h2>
                <p id="fb-album-modal-description"></p>
                <div id="fb-album-container" class="fb-album-grid"></div>
            </div>
        </div>

        <!-- SMS Messages Modal -->
        <div id="sms-messages-modal" class="modal">
            <div class="modal-content" style="max-width: 1400px; width: 95vw; background: #fff; border-radius: 0; box-shadow: 0 8px 32px rgba(0,0,0,0.18); padding: 0; position: relative; display: flex; flex-direction: column; height: 90vh;">
                <div style="display: flex; flex: 1; overflow: hidden;">
                    <!-- Master Pane (Left) - WhatsApp Style -->
                    <div id="sms-chat-list-pane" style="width: 400px; min-width: 300px; max-width: 500px; border-right: 1px solid #e9edef; display: flex; flex-direction: column; background-color: #f0f2f5;">
                        <!-- Chat List Header -->
                        <div style="padding: 10px 16px; background-color: #f0f2f5; display: flex; align-items: center; gap: 12px; position: relative;">
                            <div style="flex: 1;">
                                <div style="color: #111b21; font-size: 16pt; font-weight: 500; margin-bottom: 4px;">Messages and Chats</div>
                                <input type="text" id="sms-chat-search" placeholder="Search..." style="width: 100%; padding: 8px 12px; border-radius: 8px; border: none; background-color: #fff; font-size: 14px; box-sizing: border-box; color: #667781;">
                            </div>
                        </div>
                        <!-- Filter Buttons -->
                        <div id="sms-chat-filters" style="padding: 8px 16px; background-color: #fff; border-bottom: 1px solid #e9edef; display: flex; flex-wrap: wrap; gap: 6px; align-items: center;">
                            <label id="filter-imessage-label" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border-radius: 20px; background-color: #d1e7dd; border: 2px solid #0f3251; white-space: nowrap; transition: all 0.2s;" onmouseover="if(!this.querySelector('input').checked) this.style.backgroundColor='#e4e6eb'; this.style.borderColor='#e4e6eb';" onmouseout="if(!this.querySelector('input').checked) this.style.backgroundColor='#f0f2f5'; this.style.borderColor='#f0f2f5';">
                                <input type="checkbox" id="filter-imessage" class="sms-filter-checkbox" checked style="margin-right: 6px; cursor: pointer; display: none;">
                                <i class="fab fa-apple" style="color: #0f3251; margin-right: 4px; font-size: 12px;"></i><span style="font-size: 12px; color: #0f3251; font-weight: 600;">iMessage</span>
                            </label>
                            <label id="filter-sms-label" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border-radius: 20px; background-color: #d1e7dd; border: 2px solid #0f3251; white-space: nowrap; transition: all 0.2s;" onmouseover="if(!this.querySelector('input').checked) this.style.backgroundColor='#e4e6eb'; this.style.borderColor='#e4e6eb';" onmouseout="if(!this.querySelector('input').checked) this.style.backgroundColor='#f0f2f5'; this.style.borderColor='#f0f2f5';">
                                <input type="checkbox" id="filter-sms" class="sms-filter-checkbox" checked style="margin-right: 6px; cursor: pointer; display: none;">
                                <i class="fas fa-comment" style="color: #0f3251; margin-right: 4px; font-size: 12px;"></i><span style="font-size: 12px; color: #0f3251; font-weight: 600;">SMS</span>
                            </label>
                            <label id="filter-whatsapp-label" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border-radius: 20px; background-color: #d1e7dd; border: 2px solid #0f3251; white-space: nowrap; transition: all 0.2s;" onmouseover="if(!this.querySelector('input').checked) this.style.backgroundColor='#e4e6eb'; this.style.borderColor='#e4e6eb';" onmouseout="if(!this.querySelector('input').checked) this.style.backgroundColor='#f0f2f5'; this.style.borderColor='#f0f2f5';">
                                <input type="checkbox" id="filter-whatsapp" class="sms-filter-checkbox" checked style="margin-right: 6px; cursor: pointer; display: none;">
                                <i class="fab fa-whatsapp" style="color: #0f3251; margin-right: 4px; font-size: 12px;"></i><span style="font-size: 12px; color: #0f3251; font-weight: 600;">WhatsApp</span>
                            </label>
                            <label id="filter-facebook-label" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border-radius: 20px; background-color: #d1e7dd; border: 2px solid #0f3251; white-space: nowrap; transition: all 0.2s;" onmouseover="if(!this.querySelector('input').checked) this.style.backgroundColor='#e4e6eb'; this.style.borderColor='#e4e6eb';" onmouseout="if(!this.querySelector('input').checked) this.style.backgroundColor='#f0f2f5'; this.style.borderColor='#f0f2f5';">
                                <input type="checkbox" id="filter-facebook" class="sms-filter-checkbox" checked style="margin-right: 6px; cursor: pointer; display: none;">
                                <i class="fab fa-facebook-messenger" style="color: #0f3251; margin-right: 4px; font-size: 12px;"></i><span style="font-size: 12px; color: #0f3251; font-weight: 600;">Facebook</span>
                            </label>
                            <label id="filter-instagram-label" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border-radius: 20px; background-color: #d1e7dd; border: 2px solid #0f3251; white-space: nowrap; transition: all 0.2s;" onmouseover="if(!this.querySelector('input').checked) this.style.backgroundColor='#e4e6eb'; this.style.borderColor='#e4e6eb';" onmouseout="if(!this.querySelector('input').checked) this.style.backgroundColor='#f0f2f5'; this.style.borderColor='#f0f2f5';">
                                <input type="checkbox" id="filter-instagram" class="sms-filter-checkbox" checked style="margin-right: 6px; cursor: pointer; display: none;">
                                <i class="fab fa-instagram" style="color: #0f3251; margin-right: 4px; font-size: 12px;"></i><span style="font-size: 12px; color: #0f3251; font-weight: 600;">Instagram</span>
                            </label>
                            <label id="filter-mixed-label" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border-radius: 20px; background-color: #d1e7dd; border: 2px solid #0f3251; white-space: nowrap; transition: all 0.2s;" onmouseover="if(!this.querySelector('input').checked) this.style.backgroundColor='#e4e6eb'; this.style.borderColor='#e4e6eb';" onmouseout="if(!this.querySelector('input').checked) this.style.backgroundColor='#f0f2f5'; this.style.borderColor='#f0f2f5';">
                                <input type="checkbox" id="filter-mixed" class="sms-filter-checkbox" checked style="margin-right: 6px; cursor: pointer; display: none;">
                                <i class="fas fa-comments" style="color: #0f3251; margin-right: 4px; font-size: 12px;"></i><span style="font-size: 12px; color: #0f3251; font-weight: 600;">Mixed</span>
                            </label>
                        </div>
                        <div id="sms-chat-sessions-list" style="flex: 1; overflow-y: auto; background-color: #fff;">
                            <!-- Chat sessions will be loaded here -->
                            <div style="text-align: center; padding: 2rem; color: #667781;">Loading conversations...</div>
                        </div>
                    </div>
                    <!-- Slave Pane (Right) - Chat View -->
                    <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden; background-color: #efeae2; background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iYSIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiPjxwYXRoIGQ9Ik0wIDBoMTAwdjEwMEgweiIgZmlsbD0iI2VmZWFlMiIvPjxwYXRoIGQ9Ik0yMCAyMGgxMHYxMEgyMHoiIGZpbGw9IiNkNWQ1ZDUiIG9wYWNpdHk9IjAuMDMiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSJ1cmwoI2EpIi8+PC9zdmc+'); position: relative;">
                        <div id="sms-conversation-header" style="padding: 10px 16px 10px 16px; padding-right: 60px; border-bottom: 1px solid #e9edef; background-color: #f0f2f5; display: flex; justify-content: space-between; align-items: center; min-height: 60px; position: relative;">
                            <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                <div id="sms-conversation-type-icon" style="display: none; font-size: 20px;"></div>
                                <div style="flex: 1;">
                                    <h3 id="sms-conversation-title" style="margin: 0; color: #111b21; font-size: 16px; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                                        <span id="sms-conversation-title-text">Select a conversation</span>
                                    </h3>
                                    <div id="sms-conversation-subtitle" style="font-size: 13px; color: #667781; margin-top: 2px;"></div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button id="sms-ask-ai-btn" style="display: none; background-color: #9B59B6; color: white; border: none; cursor: pointer; font-size: 0.9em; padding: 8px 16px; border-radius: 8px; transition: background-color 0.2s; font-weight: 500;" title="Ask the AI" onmouseover="this.style.backgroundColor='#7D3C98'" onmouseout="this.style.backgroundColor='#9B59B6'">
                                    <i class="fas fa-robot" style="margin-right: 6px;"></i>Ask the AI
                                </button>
                                <button id="sms-delete-conversation-btn" style="display: none; background: none; border: none; color: #54656f; cursor: pointer; font-size: 1.2em; padding: 8px; border-radius: 50%; transition: background-color 0.2s;" title="Delete conversation" onmouseover="this.style.backgroundColor='#e4e6eb'" onmouseout="this.style.backgroundColor='transparent'">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <button class="modal-close-btn" id="close-sms-messages-modal" style="position: absolute; top: 12px; right: 12px; background-color: rgba(255, 255, 255, 0.9); border: 1px solid #e9edef; color: #54656f; cursor: pointer; font-size: 1.7rem; padding: 6px 12px; border-radius: 6px; transition: all 0.2s; z-index: 1000; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-weight: bold; line-height: 1;" onmouseover="this.style.backgroundColor='#fff'; this.style.color='#111b21'; this.style.borderColor='#d1d7db';" onmouseout="this.style.backgroundColor='rgba(255,255,255,0.9)'; this.style.color='#54656f'; this.style.borderColor='#e9edef';" title="Close">&times;</button>
                        </div>
                        <div id="sms-conversation-messages" style="flex: 1; overflow-y: auto; padding: 20px; background-color: transparent;">
                            <div id="sms-conversation-instructions" style="text-align: center; padding: 3rem; color: #667781;">
                                Select a conversation from the list to view messages
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Change User ID Modal -->
        <div id="change-user-id-modal" class="modal">
            <div class="modal-content" style="max-width: 500px; width: 90vw; background: #fff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.18); padding: 2rem; position: relative;">
                <button class="modal-close-btn" id="close-change-user-id-modal" style="position: absolute; top: 12px; right: 18px; font-size: 1.7rem; background: none; border: none; color: #bfc9da; cursor: pointer;">&times;</button>
                <h2 style="margin-top: 0; color: #233366; font-size: 1.3em; text-align: center;">Change User ID</h2>
                <div style="margin-bottom: 1.5em;">
                    <label for="current-user-id" style="display: block; color: #333; font-weight: bold; margin-bottom: 0.5em;">Current User ID:</label>
                    <input id="current-user-id" type="text" readonly style="width: 100%; border-radius: 6px; border: 1px solid #bfc9da; padding: 0.7em; font-size: 1em; background-color: #f8f9fa; color: #666;" />
                </div>
                <div style="margin-bottom: 1.5em;">
                    <label for="new-user-id" style="display: block; color: #333; font-weight: bold; margin-bottom: 0.5em;">New User ID:</label>
                    <input id="new-user-id" type="text" placeholder="Enter new User ID..." style="width: 100%; border-radius: 6px; border: 1px solid #bfc9da; padding: 0.7em; font-size: 1em;" />
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 0.7em;">
                    <button type="button" id="change-user-id-cancel-btn" class="modal-btn modal-btn-secondary">Cancel</button>
                    <button type="button" id="change-user-id-confirm-btn" class="modal-btn modal-btn-primary">Change User ID</button>
                </div>
            </div>
        </div>


    </div>

    <script src="/static/js/new_page.js"></script>
    <script src="/static/js/leaflet.js"></script>
    <script src="/static/js/images_grid.js"></script>
    <script>
        // Function to show confirmation modal

        document.addEventListener('DOMContentLoaded', function() {
            var editBtn = document.getElementById('edit-davebio-btn');
            if (editBtn) {
                editBtn.addEventListener('click', function() {
                    window.open('/davebio_editor', '_blank');
                });
            }


        });
    </script>
</body>

</html>